<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EditorPreviewPanel Test - aiNote</title>
    <link rel="stylesheet" href="src/styles.css">
    <link rel="stylesheet" href="src/js/components/markdown-editor.css">
    <link rel="stylesheet" href="src/js/components/preview-renderer.css">
    <link rel="stylesheet" href="src/js/components/editor-preview-panel.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .test-header {
            background: #3b82f6;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .test-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .test-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        .test-content {
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        .test-panel {
            flex: 1;
            border: none;
        }
        .performance-stats {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            font-family: 'SFMono-Regular', Monaco, 'Cascadia Code', monospace;
            font-size: 0.75rem;
            color: #64748b;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
        }
        .stat-label {
            font-weight: 500;
        }
        .stat-value {
            color: #1e293b;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>EditorPreviewPanel Test</h1>
            <div class="test-controls">
                <button class="test-btn" onclick="toggleMode()">Toggle Mode</button>
                <button class="test-btn" onclick="loadSampleContent()">Load Sample</button>
                <button class="test-btn" onclick="clearContent()">Clear</button>
                <button class="test-btn" onclick="showStats()">Show Stats</button>
                <button class="test-btn" onclick="testKeyboardShortcuts()">Test Shortcuts</button>
            </div>
        </div>
        <div class="test-content">
            <div id="editorPreviewContainer" class="test-panel"></div>
        </div>
        <div class="performance-stats">
            <div class="stats-grid" id="statsGrid">
                <div class="stat-item">
                    <span class="stat-label">Current Mode:</span>
                    <span class="stat-value" id="currentMode">editor</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Mode Switches:</span>
                    <span class="stat-value" id="modeSwitches">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Switch Time:</span>
                    <span class="stat-value" id="avgSwitchTime">0ms</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Scroll Syncs:</span>
                    <span class="stat-value" id="scrollSyncs">0</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Mock AppState for testing
        class MockAppState {
            constructor() {
                this.state = {
                    viewMode: 'editor',
                    currentFile: null,
                    isDirty: false
                };
                this.listeners = new Map();
            }

            getState() {
                return { ...this.state };
            }

            setViewMode(mode) {
                this.state.viewMode = mode;
                this.emit('view_mode_changed', { mode });
            }

            toggleViewMode() {
                const newMode = this.state.viewMode === 'editor' ? 'preview' : 'editor';
                this.setViewMode(newMode);
                return newMode;
            }

            emit(event, data) {
                const handlers = this.listeners.get(event) || [];
                handlers.forEach(handler => handler({ detail: data }));
            }

            addEventListener(event, handler) {
                if (!this.listeners.has(event)) {
                    this.listeners.set(event, []);
                }
                this.listeners.get(event).push(handler);
            }
        }

        // Initialize test
        const mockAppState = new MockAppState();
        let editorPreviewPanel;

        // Import and initialize EditorPreviewPanel
        import('./src/js/components/editor-preview-panel.js').then(({ default: EditorPreviewPanel }) => {
            const container = document.getElementById('editorPreviewContainer');
            editorPreviewPanel = new EditorPreviewPanel(container, mockAppState);

            // Listen for mode changes
            editorPreviewPanel.addEventListener(EditorPreviewPanel.EVENTS.MODE_CHANGED, (event) => {
                updateStats();
                console.log('Mode changed:', event.detail);
            });

            // Listen for performance events
            editorPreviewPanel.addEventListener(EditorPreviewPanel.EVENTS.ANIMATION_COMPLETED, (event) => {
                console.log('Animation completed:', event.detail);
            });

            console.log('✅ EditorPreviewPanel test initialized');
            updateStats();
        }).catch(error => {
            console.error('❌ Failed to initialize test:', error);
            document.getElementById('editorPreviewContainer').innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #dc2626;">
                    <h2>Initialization Error</h2>
                    <p>Failed to load EditorPreviewPanel: ${error.message}</p>
                    <pre style="text-align: left; background: #f3f4f6; padding: 1rem; border-radius: 6px; margin-top: 1rem;">${error.stack}</pre>
                </div>
            `;
        });

        // Test functions
        window.toggleMode = function() {
            if (editorPreviewPanel) {
                editorPreviewPanel.toggleMode();
            }
        };

        window.loadSampleContent = function() {
            const sampleMarkdown = `# EditorPreviewPanel Test

This is a test document for the **EditorPreviewPanel** component.

## Features

- ✅ **Smooth Mode Switching** - Toggle between editor and preview modes
- ✅ **Scroll Synchronization** - Maintain scroll position during mode switches  
- ✅ **Keyboard Shortcuts** - Use \`Ctrl+Shift+P\` to toggle modes
- ✅ **State Persistence** - Remember mode preferences per file
- ✅ **Performance Optimization** - Target <100ms for mode switches

## Code Example

\`\`\`javascript
const panel = new EditorPreviewPanel(container, appState);
panel.setContent('# Hello World');
panel.toggleMode();
\`\`\`

## Lists

1. First item
2. Second item  
3. Third item

- Bullet point one
- Bullet point two
- Bullet point three

## Blockquote

> This is a blockquote to test how the preview renderer handles different markdown elements.

## Table

| Feature | Status | Performance Target |
|---------|--------|-------------------|
| Mode Switch | ✅ | <100ms |
| Scroll Sync | ✅ | <50ms |
| Animation | ✅ | 60fps |

## Links and Images

[Test link](https://example.com)

---

**Testing complete!** Use the controls above to test different features.`;

            if (editorPreviewPanel) {
                editorPreviewPanel.setContent(sampleMarkdown);
            }
        };

        window.clearContent = function() {
            if (editorPreviewPanel) {
                editorPreviewPanel.setContent('');
            }
        };

        window.showStats = function() {
            if (editorPreviewPanel) {
                const stats = editorPreviewPanel.getPerformanceStats();
                const diagnostics = editorPreviewPanel.getDiagnostics();
                console.log('Performance Stats:', stats);
                console.log('Diagnostics:', diagnostics);
                alert('Performance stats logged to console. Check developer tools.');
            }
        };

        window.testKeyboardShortcuts = function() {
            alert('Test keyboard shortcuts:\\n\\n- Ctrl+Shift+P: Toggle mode\\n- Alt+E: Switch to editor\\n- Alt+P: Switch to preview\\n\\nTry them now!');
        };

        function updateStats() {
            if (!editorPreviewPanel) return;

            const stats = editorPreviewPanel.getPerformanceStats();
            
            document.getElementById('currentMode').textContent = stats.currentMode || 'editor';
            document.getElementById('modeSwitches').textContent = stats.modeSwitches || 0;
            document.getElementById('avgSwitchTime').textContent = `${stats.averageSwitchTime || 0}ms`;
            document.getElementById('scrollSyncs').textContent = stats.scrollSyncs || 0;
        }

        // Update stats periodically
        setInterval(updateStats, 1000);

        // Log test information
        console.log('🧪 EditorPreviewPanel Test Environment');
        console.log('📋 Available test functions:', {
            toggleMode: 'Toggle between editor and preview modes',
            loadSampleContent: 'Load sample markdown content',
            clearContent: 'Clear all content',
            showStats: 'Display performance statistics',
            testKeyboardShortcuts: 'Show keyboard shortcut help'
        });
        console.log('⌨️ Keyboard shortcuts: Ctrl+Shift+P (toggle), Ctrl+1 (editor), Ctrl+2 (preview)');
    </script>
</body>
</html>