<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Console - Markdown Parser</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .log { background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #007acc; }
        .error { border-left-color: #dc3545; background: #fff5f5; }
        .success { border-left-color: #28a745; background: #f5fff5; }
        button { padding: 10px 20px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005999; }
    </style>
</head>
<body>
    <h1>Markdown Parser Debug Console</h1>
    <p>This page will help identify any JavaScript issues with the markdown parser.</p>
    
    <button onclick="testBasicFunctionality()">Test Basic Functionality</button>
    <button onclick="testModuleImport()">Test Module Import</button>
    <button onclick="testPerformance()">Test Performance</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div id="log"></div>

    <script>
        function log(message, type = 'log') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log ${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function testBasicFunctionality() {
            log('Testing basic functionality...');
            
            try {
                // Test if we can create basic objects
                const testObj = { test: 'value' };
                log('✅ Basic object creation works', 'success');
                
                // Test template literals
                const testTemplate = `Template literal test: ${testObj.test}`;
                log(`✅ Template literals work: ${testTemplate}`, 'success');
                
                // Test arrow functions
                const testArrow = () => 'Arrow function works';
                log(`✅ Arrow functions work: ${testArrow()}`, 'success');
                
                // Test async/await basic syntax
                const testAsync = async () => 'Async works';
                log('✅ Async function syntax works', 'success');
                
            } catch (error) {
                log(`❌ Basic functionality error: ${error.message}`, 'error');
            }
        }
        
        async function testModuleImport() {
            log('Testing ES6 module import...');
            
            try {
                // Try to import the markdown parser
                const { default: MarkdownParser } = await import('./markdown-parser.js');
                log('✅ MarkdownParser imported successfully', 'success');
                
                const parser = new MarkdownParser();
                log('✅ MarkdownParser instance created', 'success');
                
                // Test basic parsing
                const testMarkdown = '# Test Header\\n\\nThis is **bold** text.';
                const result = parser.parse(testMarkdown);
                log(`✅ Basic parsing works. Output length: ${result.length} chars`, 'success');
                log(`Sample output: ${result.substring(0, 100)}...`, 'success');
                
            } catch (error) {
                log(`❌ Module import error: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
            }
            
            try {
                // Try to import the test suite
                const { markdownParserTests } = await import('./markdown-parser.test.js');
                log('✅ Test suite imported successfully', 'success');
                
            } catch (error) {
                log(`❌ Test suite import error: ${error.message}`, 'error');
            }
        }
        
        async function testPerformance() {
            log('Testing performance with large content...');
            
            try {
                const { default: MarkdownParser } = await import('./markdown-parser.js');
                const parser = new MarkdownParser();
                
                // Create a moderately large test document
                const lines = [];
                for (let i = 0; i < 100; i++) {
                    lines.push(`# Header ${i}`);
                    lines.push(`This is paragraph ${i} with **bold** and *italic* text.`);
                    lines.push('');
                }
                
                const largeMarkdown = lines.join('\\n');
                log(`Created test document with ${largeMarkdown.length} characters`, 'success');
                
                const startTime = performance.now();
                const result = parser.parse(largeMarkdown);
                const parseTime = performance.now() - startTime;
                
                log(`✅ Large document parsed successfully`, 'success');
                log(`Parse time: ${parseTime.toFixed(2)}ms`, parseTime < 100 ? 'success' : 'error');
                log(`Output length: ${result.length} characters`, 'success');
                
                const stats = parser.getStats();
                log(`Parser stats: ${JSON.stringify(stats)}`, 'success');
                
            } catch (error) {
                log(`❌ Performance test error: ${error.message}`, 'error');
            }
        }
        
        // Test for common browser compatibility issues
        log('Debug console loaded. Browser info:');
        log(`User Agent: ${navigator.userAgent}`);
        log(`ES6 modules supported: ${typeof import !== 'undefined'}`);
        log(`Template literals supported: ${(() => { try { return eval('`test`') === 'test'; } catch(e) { return false; } })()}`);
        log(`Arrow functions supported: ${(() => { try { eval('() => {}'); return true; } catch(e) { return false; } })()}`);
        
        // Automatically run basic tests
        setTimeout(() => {
            testBasicFunctionality();
        }, 500);
    </script>
</body>
</html>